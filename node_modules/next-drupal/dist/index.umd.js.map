{"version":3,"file":"index.umd.js","sources":["../src/get-cache.ts","../src/get-access-token.ts","../src/utils.ts","../src/get-menu.ts","../src/get-resource-collection.ts","../src/get-paths.ts","../src/get-resource.ts","../src/preview.ts","../src/get-resource-type.ts","../src/get-view.ts","../src/use-menu.tsx"],"sourcesContent":["import NodeCache from \"node-cache\"\n\nexport const cache = new NodeCache()\n","import { cache } from \"./get-cache\"\nimport { AccessToken } from \"./types\"\n\nconst CACHE_KEY = \"NEXT_DRUPAL_ACCESS_TOKEN\"\n\nexport async function getAccessToken(): Promise<AccessToken> {\n  if (!process.env.DRUPAL_CLIENT_ID || !process.env.DRUPAL_CLIENT_SECRET) {\n    return null\n  }\n\n  const cached = cache.get<AccessToken>(CACHE_KEY)\n  if (cached?.access_token) {\n    return cached\n  }\n\n  const basic = Buffer.from(\n    `${process.env.DRUPAL_CLIENT_ID}:${process.env.DRUPAL_CLIENT_SECRET}`\n  ).toString(\"base64\")\n\n  const response = await fetch(\n    `${process.env.NEXT_PUBLIC_DRUPAL_BASE_URL}/oauth/token`,\n    {\n      method: \"POST\",\n      headers: {\n        Authorization: `Basic ${basic}`,\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n      },\n      body: `grant_type=client_credentials`,\n    }\n  )\n\n  if (!response.ok) {\n    throw new Error(response.statusText)\n  }\n\n  const result: AccessToken = await response.json()\n\n  cache.set(CACHE_KEY, result, result.expires_in)\n\n  return result\n}\n","import { GetStaticPropsContext } from \"next\"\nimport Jsona from \"jsona\"\nimport { getAccessToken } from \"./get-access-token\"\nimport { AccessToken, Locale } from \"./types\"\nimport { stringify } from \"qs\"\n\nconst JSONAPI_PREFIX = process.env.DRUPAL_JSONAPI_PREFIX || \"/jsonapi\"\n\nconst dataFormatter = new Jsona()\n\nexport function deserialize(body, options?) {\n  if (!body) return null\n\n  return dataFormatter.deserialize(body, options)\n}\n\nexport async function getJsonApiPathForResourceType(\n  type: string,\n  locale?: Locale\n) {\n  const index = await getJsonApiIndex(locale)\n\n  return index?.links[type]?.href\n}\n\nexport async function getJsonApiIndex(\n  locale?: Locale,\n  options?: {\n    accessToken?: AccessToken\n  }\n): Promise<{\n  links: {\n    [type: string]: {\n      href: string\n    }\n  }\n}> {\n  const url = buildUrl(\n    locale ? `/${locale}${JSONAPI_PREFIX}` : `${JSONAPI_PREFIX}`\n  )\n\n  const response = await fetch(url.toString(), {\n    headers: await buildHeaders(options),\n  })\n\n  if (!response.ok) {\n    throw new Error(response.statusText)\n  }\n\n  return await response.json()\n}\n\nexport function buildUrl(\n  path: string,\n  params?: string | Record<string, string> | URLSearchParams\n): URL {\n  const url = new URL(\n    path.charAt(0) === \"/\"\n      ? `${process.env.NEXT_PUBLIC_DRUPAL_BASE_URL}${path}`\n      : path\n  )\n\n  if (params) {\n    // Use instead URLSearchParams for nested params.\n    url.search = stringify(params)\n  }\n\n  return url\n}\n\nexport async function buildHeaders({\n  accessToken,\n  headers = {\n    \"Content-Type\": \"application/json\",\n  },\n}: {\n  accessToken?: AccessToken\n  headers?: RequestInit[\"headers\"]\n} = {}): Promise<RequestInit[\"headers\"]> {\n  const token = accessToken || (await getAccessToken())\n  if (token) {\n    headers[\"Authorization\"] = `Bearer ${token.access_token}`\n  }\n\n  return headers\n}\n\nexport function getPathFromContext(\n  context: GetStaticPropsContext,\n  prefix = \"\"\n) {\n  let { slug } = context.params\n\n  slug = Array.isArray(slug) ? slug.join(\"/\") : slug\n\n  // Handle locale.\n  if (context.locale && context.locale !== context.defaultLocale) {\n    slug = `/${context.locale}/${slug}`\n  }\n\n  return !slug\n    ? process.env.DRUPAL_FRONT_PAGE\n    : prefix\n    ? `${prefix}/${slug}`\n    : slug\n}\n\nexport function syncDrupalPreviewRoutes(path) {\n  if (window && window.top !== window.self) {\n    window.parent.postMessage(\n      { type: \"NEXT_DRUPAL_ROUTE_SYNC\", path },\n      process.env.NEXT_PUBLIC_DRUPAL_BASE_URL\n    )\n  }\n}\n","import {\n  AccessToken,\n  DrupalMenuLinkContent,\n  JsonApiWithLocaleOptions,\n} from \"./types\"\nimport { buildHeaders, buildUrl, deserialize } from \"./utils\"\n\nexport async function getMenu(\n  name: string,\n  options?: {\n    deserialize?: boolean\n    accessToken?: AccessToken\n  } & JsonApiWithLocaleOptions\n): Promise<{\n  items: DrupalMenuLinkContent[]\n  tree: DrupalMenuLinkContent[]\n}> {\n  options = {\n    deserialize: true,\n    ...options,\n  }\n\n  const localePrefix =\n    options?.locale && options.locale !== options.defaultLocale\n      ? `/${options.locale}`\n      : \"\"\n\n  const url = buildUrl(`${localePrefix}/jsonapi/menu_items/${name}`)\n\n  const response = await fetch(url.toString(), {\n    headers: await buildHeaders(options),\n  })\n\n  if (!response.ok) {\n    throw new Error(response.statusText)\n  }\n\n  const data = await response.json()\n\n  const items = options.deserialize ? deserialize(data) : data\n\n  const { items: tree } = buildMenuTree(items)\n\n  return {\n    items,\n    tree,\n  }\n}\n\nfunction buildMenuTree(\n  links: DrupalMenuLinkContent[],\n  parent: DrupalMenuLinkContent[\"id\"] = \"\"\n) {\n  const children = links.filter((link) => link.parent === parent)\n\n  return children.length\n    ? {\n        items: children.map((link) => ({\n          ...link,\n          ...buildMenuTree(links, link.id),\n        })),\n      }\n    : {}\n}\n","import { GetStaticPropsContext } from \"next\"\nimport {\n  AccessToken,\n  JsonApiParams,\n  JsonApiWithLocaleOptions,\n  JsonApiResource,\n} from \"./types\"\nimport {\n  buildHeaders,\n  buildUrl,\n  deserialize,\n  getJsonApiPathForResourceType,\n} from \"./utils\"\n\nexport async function getResourceCollection<T = JsonApiResource[]>(\n  type: string,\n  options?: {\n    deserialize?: boolean\n    accessToken?: AccessToken\n  } & JsonApiWithLocaleOptions\n): Promise<T> {\n  options = {\n    deserialize: true,\n    ...options,\n  }\n\n  const apiPath = await getJsonApiPathForResourceType(\n    type,\n    options?.locale !== options?.defaultLocale ? options.locale : undefined\n  )\n\n  if (!apiPath) {\n    throw new Error(`Error: resource of type ${type} not found.`)\n  }\n\n  const url = buildUrl(apiPath, {\n    ...options?.params,\n  })\n\n  const response = await fetch(url.toString(), {\n    headers: await buildHeaders(options),\n  })\n\n  if (!response.ok) {\n    throw new Error(response.statusText)\n  }\n\n  const json = await response.json()\n\n  return options.deserialize ? deserialize(json) : json\n}\n\nexport async function getResourceCollectionFromContext<T = JsonApiResource[]>(\n  type: string,\n  context: GetStaticPropsContext,\n  options?: {\n    deserialize?: boolean\n    params?: JsonApiParams\n  }\n): Promise<T> {\n  options = {\n    deserialize: true,\n    ...options,\n  }\n\n  // // Filter out unpublished entities.\n  // if (!context.preview) {\n  //   options.params = {\n  //     \"filter[status]\": \"1\",\n  //     ...options.params,\n  //   }\n  // }\n\n  return await getResourceCollection<T>(type, {\n    ...options,\n    locale: context.locale,\n    defaultLocale: context.defaultLocale,\n  })\n}\n","import { GetStaticPathsContext, GetStaticPathsResult } from \"next\"\nimport { getResourceCollection } from \"./get-resource-collection\"\nimport { AccessToken, JsonApiParams, Locale } from \"./types\"\n\nexport async function getPathsFromContext(\n  types: string | string[],\n  context: GetStaticPathsContext,\n  options: {\n    params?: JsonApiParams\n    accessToken?: AccessToken\n  } = {}\n): Promise<GetStaticPathsResult[\"paths\"]> {\n  if (typeof types === \"string\") {\n    types = [types]\n  }\n\n  const paths = await Promise.all(\n    types.map(async (type) => {\n      // Use sparse fieldset to expand max size.\n      options.params = {\n        [`fields[${type}]`]: \"path\",\n        ...options?.params,\n      }\n\n      // const paths = await Promise.all(\n      //   context.locales.map(async (locale) => {\n      //     const resources = await getResourceCollection(type, {\n      //       deserialize: true,\n      //       locale,\n      //       defaultLocale: context.defaultLocale,\n      //       ...options,\n      //     })\n\n      //     return buildPathsFromResources(resources, locale)\n      //   })\n      // )\n\n      // return paths.flat()\n\n      // Handle localized path aliases\n      if (!context.locales?.length) {\n        const resources = await getResourceCollection(type, {\n          deserialize: true,\n          ...options,\n        })\n\n        return buildPathsFromResources(resources)\n      }\n\n      const paths = await Promise.all(\n        context.locales.map(async (locale) => {\n          const resources = await getResourceCollection(type, {\n            deserialize: true,\n            locale,\n            defaultLocale: context.defaultLocale,\n            ...options,\n          })\n\n          return buildPathsFromResources(resources, locale)\n        })\n      )\n\n      return paths.flat()\n    })\n  )\n\n  return paths.flat()\n}\n\nfunction buildPathsFromResources(resources, locale?: Locale) {\n  return resources?.flatMap((resource) => {\n    const slug =\n      resource?.path?.alias === process.env.DRUPAL_FRONT_PAGE\n        ? \"/\"\n        : resource?.path?.alias\n\n    const path = {\n      params: {\n        slug: `${slug?.replace(/^\\/|\\/$/g, \"\")}`.split(\"/\"),\n      },\n    }\n\n    if (locale) {\n      path[\"locale\"] = locale\n    }\n\n    return path\n  })\n}\n","import { GetStaticPropsContext } from \"next\"\nimport {\n  AccessToken,\n  JsonApiParams,\n  JsonApiWithLocaleOptions,\n  JsonApiResource,\n} from \"./types\"\nimport {\n  buildHeaders,\n  buildUrl,\n  deserialize,\n  getJsonApiPathForResourceType,\n  getPathFromContext,\n} from \"./utils\"\n\nexport async function getResourceFromContext<T extends JsonApiResource>(\n  type: string,\n  context: GetStaticPropsContext,\n  options?: {\n    prefix?: string\n    deserialize?: boolean\n    params?: JsonApiParams\n    accessToken?: AccessToken\n    isVersionable?: boolean\n  }\n): Promise<T> {\n  options = {\n    deserialize: true,\n    // Add support for revisions for node by default.\n    // TODO: Make this required before stable?\n    isVersionable: /^node--/.test(type),\n    ...options,\n  }\n\n  const path = getPathFromContext(context, options?.prefix)\n\n  // Filter out unpublished entities.\n  // if (!context.preview) {\n  //   options.params = {\n  //     \"filter[status]\": \"1\",\n  //     ...options?.params,\n  //   }\n  // }\n\n  const previewData = context.previewData as { resourceVersion?: string }\n\n  const resource = await getResourceByPath<T>(path, {\n    deserialize: options.deserialize,\n    isVersionable: options.isVersionable,\n    locale: context.locale,\n    defaultLocale: context.defaultLocale,\n    params: {\n      resourceVersion: previewData?.resourceVersion,\n      ...options?.params,\n    },\n  })\n\n  // If no locale is passed, skip entity if not default_langcode.\n  // This happens because decoupled_router will still translate the path\n  // to a resource.\n  // TODO: Figure out if we want this behavior.\n  // For now this causes a bug where a non-i18n sites builds (ISR) pages for\n  // localized pages.\n  if (!context.locale && !resource?.default_langcode) {\n    return null\n  }\n\n  return resource\n}\n\nexport async function getResourceByPath<T extends JsonApiResource>(\n  path: string,\n  options?: {\n    accessToken?: AccessToken\n    deserialize?: boolean\n    isVersionable?: boolean\n  } & JsonApiWithLocaleOptions\n): Promise<T> {\n  options = {\n    deserialize: true,\n    isVersionable: false,\n    params: {},\n    ...options,\n  }\n\n  if (!path) {\n    return null\n  }\n\n  if (\n    options.locale &&\n    options.defaultLocale &&\n    path.indexOf(options.locale) !== 1\n  ) {\n    path = path === \"/\" ? path : path.replace(/^\\/+/, \"\")\n    path = getPathFromContext({\n      params: { slug: [path] },\n      locale: options.locale,\n      defaultLocale: options.defaultLocale,\n    })\n  }\n\n  const { resourceVersion = \"rel:latest-version\", ...params } = options?.params\n  const resourceParams = new URLSearchParams({\n    ...params,\n  })\n\n  if (options.isVersionable) {\n    resourceParams.set(\"resourceVersion\", resourceVersion)\n  }\n\n  const payload = [\n    {\n      requestId: \"router\",\n      action: \"view\",\n      uri: `/router/translate-path?path=${path}&_format=json`,\n      headers: { Accept: \"application/vnd.api+json\" },\n    },\n    {\n      requestId: \"resolvedResource\",\n      action: \"view\",\n      uri: `{{router.body@$.jsonapi.individual}}?${resourceParams.toString()}`,\n      waitFor: [\"router\"],\n    },\n  ]\n\n  // Localized subrequests.\n  // I was hoping we would not need this but it seems like subrequests is not properly\n  // setting the jsonapi locale from a translated path.\n  let subrequestsPath = \"/subrequests\"\n  if (\n    options.locale &&\n    options.defaultLocale &&\n    options.locale !== options.defaultLocale\n  ) {\n    subrequestsPath = `/${options.locale}/subrequests`\n  }\n\n  const url = buildUrl(subrequestsPath, {\n    _format: \"json\",\n  })\n\n  const response = await fetch(url.toString(), {\n    method: \"POST\",\n    credentials: \"include\",\n    headers: await buildHeaders(options),\n    redirect: \"follow\",\n    body: JSON.stringify(payload),\n  })\n\n  if (!response.ok) {\n    throw new Error(response.statusText)\n  }\n\n  const json = await response.json()\n\n  if (!json[\"resolvedResource#uri{0}\"]) {\n    return null\n  }\n\n  const data = JSON.parse(json[\"resolvedResource#uri{0}\"]?.body)\n\n  if (data.errors) {\n    throw new Error(data.errors[0].detail)\n  }\n\n  return options.deserialize ? deserialize(data) : data\n}\n\nexport async function getResource<T extends JsonApiResource>(\n  type: string,\n  uuid: string,\n  options?: {\n    accessToken?: AccessToken\n    deserialize?: boolean\n  } & JsonApiWithLocaleOptions\n): Promise<T> {\n  options = {\n    deserialize: true,\n    params: {},\n    ...options,\n  }\n\n  const apiPath = await getJsonApiPathForResourceType(\n    type,\n    options?.locale !== options?.defaultLocale ? options.locale : undefined\n  )\n\n  if (!apiPath) {\n    throw new Error(`Error: resource of type ${type} not found.`)\n  }\n\n  const url = buildUrl(`${apiPath}/${uuid}`, {\n    ...options?.params,\n  })\n\n  const response = await fetch(url.toString(), {\n    headers: await buildHeaders(options),\n  })\n\n  if (!response.ok) {\n    throw new Error(response.statusText)\n  }\n\n  const json = await response.json()\n\n  return options.deserialize ? deserialize(json) : json\n}\n","import { NextApiRequest, NextApiResponse } from \"next\"\nimport { getResourceByPath } from \"./get-resource\"\nimport { JsonApiWithLocaleOptions } from \"./types\"\n\ninterface PreviewOptions {\n  errorMessages?: {\n    secret?: string\n    slug?: string\n  }\n}\n\nexport function DrupalPreview(options?: PreviewOptions) {\n  return (request, response) => PreviewHandler(request, response, options)\n}\n\nexport async function PreviewHandler(\n  request?: NextApiRequest,\n  response?: NextApiResponse,\n  options?: PreviewOptions\n) {\n  const { slug, resourceVersion, secret, locale, defaultLocale } = request.query\n\n  if (secret !== process.env.DRUPAL_PREVIEW_SECRET) {\n    return response.status(401).json({\n      message: options?.errorMessages.secret || \"Invalid preview secret.\",\n    })\n  }\n\n  if (!slug) {\n    return response\n      .status(401)\n      .end({ message: options?.errorMessages.slug || \"Invalid slug.\" })\n  }\n\n  let _options: GetResourcePreviewUrlOptions = {\n    isVersionable: typeof resourceVersion !== \"undefined\",\n  }\n  if (locale && defaultLocale) {\n    _options = {\n      ..._options,\n      locale: locale as string,\n      defaultLocale: defaultLocale as string,\n    }\n  }\n\n  const url = await getResourcePreviewUrl(slug as string, _options)\n\n  if (!url) {\n    response\n      .status(404)\n      .end({ message: options?.errorMessages.slug || \"Invalid slug\" })\n  }\n\n  response.setPreviewData({\n    resourceVersion,\n  })\n\n  response.writeHead(307, { Location: url })\n\n  return response.end()\n}\n\ntype GetResourcePreviewUrlOptions = JsonApiWithLocaleOptions & {\n  isVersionable?: boolean\n}\n\nexport async function getResourcePreviewUrl(\n  slug: string,\n  options?: GetResourcePreviewUrlOptions\n) {\n  const entity = await getResourceByPath(slug, options)\n\n  if (!entity) {\n    return null\n  }\n\n  if (!entity?.path) {\n    throw new Error(\n      `Error: the path attribute is missing for entity type ${entity.type}`\n    )\n  }\n\n  return entity?.default_langcode\n    ? entity.path.alias\n    : `/${entity.path.langcode}${entity.path.alias}`\n}\n","import { GetStaticPropsContext } from \"next\"\nimport { AccessToken } from \"./types\"\nimport { buildHeaders, buildUrl, getPathFromContext } from \"./utils\"\n\nexport async function getResourceTypeFromContext(\n  context: GetStaticPropsContext,\n  options?: {\n    accessToken?: AccessToken\n    prefix?: string\n  }\n): Promise<string> {\n  options = {\n    prefix: \"\",\n    ...options,\n  }\n  const url = buildUrl(\"/router/translate-path\", {\n    path: getPathFromContext(context, options.prefix),\n  })\n\n  const response = await fetch(url.toString(), {\n    headers: await buildHeaders(options),\n  })\n\n  if (response.status === 404) {\n    return null\n  }\n\n  if (!response.ok) {\n    throw new Error(response.statusText)\n  }\n\n  const json = await response.json()\n\n  return json.jsonapi.resourceName\n}\n","import { AccessToken, JsonApiWithLocaleOptions } from \"./types\"\nimport { buildHeaders, buildUrl, deserialize } from \"./utils\"\n\nexport async function getView<T>(\n  name: string,\n  options?: {\n    deserialize?: boolean\n    accessToken?: AccessToken\n  } & JsonApiWithLocaleOptions\n): Promise<{\n  results: T\n  /* eslint-disable  @typescript-eslint/no-explicit-any */\n  meta: Record<string, any>\n  links: {\n    [key in \"next\" | \"prev\" | \"self\"]?: {\n      href: \"string\"\n    }\n  }\n}> {\n  options = {\n    deserialize: true,\n    ...options,\n  }\n\n  const localePrefix =\n    options?.locale && options.locale !== options.defaultLocale\n      ? `/${options.locale}`\n      : \"\"\n\n  const [viewId, displayId] = name.split(\"--\")\n\n  const url = buildUrl(\n    `${localePrefix}/jsonapi/views/${viewId}/${displayId}`,\n    options.params\n  )\n\n  const response = await fetch(url.toString(), {\n    headers: await buildHeaders(options),\n  })\n\n  if (!response.ok) {\n    throw new Error(response.statusText)\n  }\n\n  const data = await response.json()\n\n  const results = options.deserialize ? deserialize(data) : data\n\n  return {\n    results,\n    meta: data.meta,\n    links: data.links,\n  }\n}\n","import * as React from \"react\"\nimport { useRouter } from \"next/router\"\n\nimport { getMenu } from \"./get-menu\"\nimport { DrupalMenuLinkContent } from \"./types\"\n\nexport function useMenu(\n  name: string\n): {\n  items: DrupalMenuLinkContent[]\n  tree: DrupalMenuLinkContent[]\n  error: unknown\n  isLoading: boolean\n} {\n  const router = useRouter()\n  const [data, setData] = React.useState<{\n    items: DrupalMenuLinkContent[]\n    tree: DrupalMenuLinkContent[]\n  }>(null)\n  const [error, setError] = React.useState(null)\n  const [isLoading, setIsLoading] = React.useState<boolean>(false)\n\n  React.useEffect(() => {\n    const fetchMenuItems = async () => {\n      setIsLoading(true)\n      try {\n        const data = await getMenu(name, {\n          locale: router.locale,\n          defaultLocale: router.defaultLocale,\n        })\n        setData(data)\n        setIsLoading(false)\n      } catch (error) {\n        setError(error)\n        setIsLoading(false)\n      }\n    }\n    fetchMenuItems()\n  }, [router.locale])\n\n  return { ...data, error, isLoading }\n}\n"],"names":["cache","NodeCache","getAccessToken","process","env","DRUPAL_CLIENT_ID","DRUPAL_CLIENT_SECRET","cached","get","CACHE_KEY","access_token","basic","Buffer","from","toString","fetch","NEXT_PUBLIC_DRUPAL_BASE_URL","method","headers","Authorization","body","response","ok","Error","statusText","json","result","set","expires_in","buildHeaders","accessToken","token","getJsonApiIndex","locale","options","url","buildUrl","JSONAPI_PREFIX","getJsonApiPathForResourceType","type","index","links","href","DRUPAL_JSONAPI_PREFIX","dataFormatter","Jsona","deserialize","path","params","URL","charAt","search","stringify","getPathFromContext","context","prefix","slug","Array","isArray","join","defaultLocale","DRUPAL_FRONT_PAGE","syncDrupalPreviewRoutes","window","top","self","parent","postMessage","getMenu","name","localePrefix","data","items","buildMenuTree","tree","children","filter","link","length","map","id","getResourceCollectionFromContext","getResourceCollection","undefined","apiPath","getPathsFromContext","types","Promise","all","locales","resources","buildPathsFromResources","paths","flat","flatMap","resource","alias","replace","split","getResource","uuid","getResourceByPath","isVersionable","indexOf","resourceVersion","resourceParams","URLSearchParams","payload","requestId","action","uri","Accept","waitFor","subrequestsPath","_format","credentials","redirect","JSON","parse","errors","detail","getResourceFromContext","test","previewData","default_langcode","getResourcePreviewUrl","entity","langcode","PreviewHandler","request","query","secret","DRUPAL_PREVIEW_SECRET","status","message","errorMessages","end","_options","setPreviewData","writeHead","Location","DrupalPreview","getResourceTypeFromContext","jsonapi","resourceName","getView","viewId","displayId","results","meta","useMenu","router","useRouter","React","setData","error","setError","isLoading","setIsLoading","fetchMenuItems"],"mappings":";;;;;;;;EAEO,IAAMA,KAAK,GAAG,IAAIC,SAAJ,EAAd;;MCGeC,cAAtB,YAAsBA,cAAtB;EAAA;EACE,QAAI,CAACC,OAAO,CAACC,GAAR,CAAYC,gBAAb,IAAiC,CAACF,OAAO,CAACC,GAAR,CAAYE,oBAAlD,EAAwE;EACtE,6BAAO,IAAP;EACD;;EAED,QAAMC,MAAM,GAAGP,KAAK,CAACQ,GAAN,CAAuBC,SAAvB,CAAf;;EACA,QAAIF,MAAJ,oBAAIA,MAAM,CAAEG,YAAZ,EAA0B;EACxB,6BAAOH,MAAP;EACD;;EAED,QAAMI,KAAK,GAAGC,MAAM,CAACC,IAAP,CACTV,OAAO,CAACC,GAAR,CAAYC,gBADH,SACuBF,OAAO,CAACC,GAAR,CAAYE,oBADnC,EAEZQ,QAFY,CAEH,QAFG,CAAd;6BAIuBC,KAAK,CACvBZ,OAAO,CAACC,GAAR,CAAYY,2BADW,mBAE1B;EACEC,MAAAA,MAAM,EAAE,MADV;EAEEC,MAAAA,OAAO,EAAE;EACPC,QAAAA,aAAa,aAAWR,KADjB;EAEP,wBAAgB;EAFT,OAFX;EAMES,MAAAA,IAAI;EANN,KAF0B,kBAAtBC;EAYN,UAAI,CAACA,QAAQ,CAACC,EAAd,EAAkB;EAChB,cAAM,IAAIC,KAAJ,CAAUF,QAAQ,CAACG,UAAnB,CAAN;EACD;;+BAEiCH,QAAQ,CAACI,IAAT,mBAA5BC;EAEN1B,QAAAA,KAAK,CAAC2B,GAAN,CAAUlB,SAAV,EAAqBiB,MAArB,EAA6BA,MAAM,CAACE,UAApC;EAEA,eAAOF,MAAP;;;EACD,GAnCD;EAAA;EAAA;EAAA;EAFA,IAAMjB,SAAS,GAAG,0BAAlB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MCmEsBoB,YAAtB,YAAsBA,YAAtB;EAAA,iCAQI,EARJ;EAAA,MACEC,WADF,QACEA,WADF;EAAA,0BAEEZ,OAFF;EAAA,MAEEA,OAFF,6BAEY;EACR,oBAAgB;EADR,GAFZ;;EAAA;mCASQa;EACN,UAAIA,KAAJ,EAAW;EACTb,QAAAA,OAAO,CAAC,eAAD,CAAP,eAAqCa,KAAK,CAACrB,YAA3C;EACD;;EAED,aAAOQ,OAAP;;;6BALcY,qBAAAA,+BAAsB5B,cAAc;EAMnD,GAfD;EAAA;EAAA;EAAA;AA7CA,MAAsB8B,eAAtB,YAAsBA,eAAtB,CACEC,MADF,EAEEC,OAFF;EAAA;EAYE,QAAMC,GAAG,GAAGC,QAAQ,CAClBH,MAAM,SAAOA,MAAP,GAAgBI,cAAhB,QAAsCA,cAD1B,CAApB;;oBAIuBtB;2BAAMoB,GAAG,CAACrB,QAAJ;;6BACZe,YAAY,CAACK,OAAD;+BADN,wBAAsB;EAC3ChB,QAAAA,OAAO;EADoC,OAAtB,kBAAjBG;EAIN,YAAI,CAACA,QAAQ,CAACC,EAAd,EAAkB;EAChB,gBAAM,IAAIC,KAAJ,CAAUF,QAAQ,CAACG,UAAnB,CAAN;EACD;;iCAEYH,QAAQ,CAACI,IAAT;;;EACd,GAzBD;EAAA;EAAA;EAAA;AATA,MAAsBa,6BAAtB,YAAsBA,6BAAtB,CACEC,IADF,EAEEN,MAFF;EAAA;6BAIsBD,eAAe,CAACC,MAAD,kBAA7BO;;;EAEN,aAAOA,KAAP,yCAAOA,KAAK,CAAEC,KAAP,CAAaF,IAAb,CAAP,qBAAO,kBAAoBG,IAA3B;;EACD,GAPD;EAAA;EAAA;EAAA;EAVA,IAAML,cAAc,GAAGlC,OAAO,CAACC,GAAR,CAAYuC,qBAAZ,IAAqC,UAA5D;EAEA,IAAMC,aAAa,GAAG,IAAIC,KAAJ,EAAtB;AAEA,WAAgBC,YAAY1B,MAAMc;EAChC,MAAI,CAACd,IAAL,EAAW,OAAO,IAAP;EAEX,SAAOwB,aAAa,CAACE,WAAd,CAA0B1B,IAA1B,EAAgCc,OAAhC,CAAP;EACD;AAsCD,WAAgBE,SACdW,MACAC;EAEA,MAAMb,GAAG,GAAG,IAAIc,GAAJ,CACVF,IAAI,CAACG,MAAL,CAAY,CAAZ,MAAmB,GAAnB,QACO/C,OAAO,CAACC,GAAR,CAAYY,2BADnB,GACiD+B,IADjD,GAEIA,IAHM,CAAZ;;EAMA,MAAIC,MAAJ,EAAY;EACV;EACAb,IAAAA,GAAG,CAACgB,MAAJ,GAAaC,YAAS,CAACJ,MAAD,CAAtB;EACD;;EAED,SAAOb,GAAP;EACD;AAmBD,WAAgBkB,mBACdC,SACAC;QAAAA;EAAAA,IAAAA,SAAS;;;QAEHC,OAASF,OAAO,CAACN,OAAjBQ;EAENA,EAAAA,IAAI,GAAGC,KAAK,CAACC,OAAN,CAAcF,IAAd,IAAsBA,IAAI,CAACG,IAAL,CAAU,GAAV,CAAtB,GAAuCH,IAA9C;;EAGA,MAAIF,OAAO,CAACrB,MAAR,IAAkBqB,OAAO,CAACrB,MAAR,KAAmBqB,OAAO,CAACM,aAAjD,EAAgE;EAC9DJ,IAAAA,IAAI,SAAOF,OAAO,CAACrB,MAAf,SAAyBuB,IAA7B;EACD;;EAED,SAAO,CAACA,IAAD,GACHrD,OAAO,CAACC,GAAR,CAAYyD,iBADT,GAEHN,MAAM,GACHA,MADG,SACOC,IADP,GAENA,IAJJ;EAKD;AAED,WAAgBM,wBAAwBf;EACtC,MAAIgB,MAAM,IAAIA,MAAM,CAACC,GAAP,KAAeD,MAAM,CAACE,IAApC,EAA0C;EACxCF,IAAAA,MAAM,CAACG,MAAP,CAAcC,WAAd,CACE;EAAE5B,MAAAA,IAAI,EAAE,wBAAR;EAAkCQ,MAAAA,IAAI,EAAJA;EAAlC,KADF,EAEE5C,OAAO,CAACC,GAAR,CAAYY,2BAFd;EAID;EACF;;MC3GqBoD,OAAtB,YAAsBA,OAAtB,CACEC,IADF,EAEEnC,OAFF;EAAA;;;EAUEA,IAAAA,OAAO;EACLY,MAAAA,WAAW,EAAE;EADR,OAEFZ,OAFE,CAAP;EAKA,QAAMoC,YAAY,GAChB,aAAApC,OAAO,SAAP,qBAASD,MAAT,KAAmBC,OAAO,CAACD,MAAR,KAAmBC,OAAO,CAAC0B,aAA9C,SACQ1B,OAAO,CAACD,MADhB,GAEI,EAHN;EAKA,QAAME,GAAG,GAAGC,QAAQ,CAAIkC,YAAJ,4BAAuCD,IAAvC,CAApB;;oBAEuBtD;2BAAMoB,GAAG,CAACrB,QAAJ;;6BACZe,YAAY,CAACK,OAAD;+BADN,wBAAsB;EAC3ChB,QAAAA,OAAO;EADoC,OAAtB,kBAAjBG;EAIN,YAAI,CAACA,QAAQ,CAACC,EAAd,EAAkB;EAChB,gBAAM,IAAIC,KAAJ,CAAUF,QAAQ,CAACG,UAAnB,CAAN;EACD;;iCAEkBH,QAAQ,CAACI,IAAT,mBAAb8C;EAEN,cAAMC,KAAK,GAAGtC,OAAO,CAACY,WAAR,GAAsBA,WAAW,CAACyB,IAAD,CAAjC,GAA0CA,IAAxD;;iCAEwBE,aAAa,CAACD,KAAD;gBAAtBE,sBAAPF;;EAER,iBAAO;EACLA,YAAAA,KAAK,EAALA,KADK;EAELE,YAAAA,IAAI,EAAJA;EAFK,WAAP;;;;EAID,GAxCD;EAAA;EAAA;EAAA;;EA0CA,SAASD,aAAT,CACEhC,KADF,EAEEyB,MAFF;QAEEA;EAAAA,IAAAA,SAAsC;;;EAEtC,MAAMS,QAAQ,GAAGlC,KAAK,CAACmC,MAAN,CAAa,UAACC,IAAD;EAAA,WAAUA,IAAI,CAACX,MAAL,KAAgBA,MAA1B;EAAA,GAAb,CAAjB;EAEA,SAAOS,QAAQ,CAACG,MAAT,GACH;EACEN,IAAAA,KAAK,EAAEG,QAAQ,CAACI,GAAT,CAAa,UAACF,IAAD;EAAA,0BACfA,IADe,EAEfJ,aAAa,CAAChC,KAAD,EAAQoC,IAAI,CAACG,EAAb,CAFE;EAAA,KAAb;EADT,GADG,GAOH,EAPJ;EAQD;;MCXqBC,gCAAtB,YAAsBA,gCAAtB,CACE1C,IADF,EAEEe,OAFF,EAGEpB,OAHF;EAAA;EAQEA,IAAAA,OAAO;EACLY,MAAAA,WAAW,EAAE;EADR,OAEFZ,OAFE,CAAP;EAMA;EACA;EACA;EACA;EACA;EACA;;6BAEagD,qBAAqB,CAAI3C,IAAJ,eAC7BL,OAD6B;EAEhCD,MAAAA,MAAM,EAAEqB,OAAO,CAACrB,MAFgB;EAGhC2B,MAAAA,aAAa,EAAEN,OAAO,CAACM;EAHS;EAKnC,GA1BD;EAAA;EAAA;EAAA;AAtCA,MAAsBsB,qBAAtB,YAAsBA,qBAAtB,CACE3C,IADF,EAEEL,OAFF;EAAA;;;EAOEA,IAAAA,OAAO;EACLY,MAAAA,WAAW,EAAE;EADR,OAEFZ,OAFE,CAAP;6BAKsBI,6BAA6B,CACjDC,IADiD,EAEjD,aAAAL,OAAO,SAAP,qBAASD,MAAT,oBAAoBC,OAApB,qBAAoB,UAAS0B,aAA7B,IAA6C1B,OAAO,CAACD,MAArD,GAA8DkD,SAFb,kBAA7CC;;;EAKN,UAAI,CAACA,OAAL,EAAc;EACZ,cAAM,IAAI7D,KAAJ,8BAAqCgB,IAArC,iBAAN;EACD;;EAED,UAAMJ,GAAG,GAAGC,QAAQ,CAACgD,OAAD,4BACflD,OADe,qBACf,UAASc,MADM,EAApB;;qBAIuBjC;4BAAMoB,GAAG,CAACrB,QAAJ;;+BACZe,YAAY,CAACK,OAAD;iCADN,sBAAsB;EAC3ChB,UAAAA,OAAO;EADoC,SAAtB,kBAAjBG;EAIN,cAAI,CAACA,QAAQ,CAACC,EAAd,EAAkB;EAChB,kBAAM,IAAIC,KAAJ,CAAUF,QAAQ,CAACG,UAAnB,CAAN;EACD;;mCAEkBH,QAAQ,CAACI,IAAT,mBAAbA;EAEN,mBAAOS,OAAO,CAACY,WAAR,GAAsBA,WAAW,CAACrB,IAAD,CAAjC,GAA0CA,IAAjD;;;;;EACD,GApCD;EAAA;EAAA;EAAA;;MCVsB4D,mBAAtB,YAAsBA,mBAAtB,CACEC,KADF,EAEEhC,OAFF,EAGEpB,OAHF;EAAA,MAGEA,OAHF;EAGEA,IAAAA,OAHF,GAMM,EANN;EAAA;;EAAA;EAQE,QAAI,OAAOoD,KAAP,KAAiB,QAArB,EAA+B;EAC7BA,MAAAA,KAAK,GAAG,CAACA,KAAD,CAAR;EACD;;6BAEmBC,OAAO,CAACC,GAAR,CAClBF,KAAK,CAACP,GAAN,WAAiBxC,IAAjB;EAAA;;;;sDAgCsBgD,OAAO,CAACC,GAAR,CAClBlC,OAAO,CAACmC,OAAR,CAAgBV,GAAhB,WAA2B9C,MAA3B;EAAA;uCAC0BiD,qBAAqB,CAAC3C,IAAD;EAC3CO,gBAAAA,WAAW,EAAE,IAD8B;EAE3Cb,gBAAAA,MAAM,EAANA,MAF2C;EAG3C2B,gBAAAA,aAAa,EAAEN,OAAO,CAACM;EAHoB,iBAIxC1B,OAJwC,mBAAvCwD;EAON,uBAAOC,uBAAuB,CAACD,SAAD,EAAYzD,MAAZ,CAA9B;;EACD,aATD;EAAA;EAAA;EAAA,YADkB,kBAAd2D;EAaN,mBAAOA,KAAK,CAACC,IAAN,EAAP;;;;;;EA5CA;EACA3D,QAAAA,OAAO,CAACc,MAAR,mDACaT,IADb,UACuB,MADvB,0BAEKL,OAFL,qBAEK,SAASc,MAFd;EAMA;EACA;EACA;EACA;EACA;EACA;EACA;EAEA;EACA;EACA;EAEA;EAEA;;;;;gBACI,sBAACM,OAAO,CAACmC,OAAT,qBAAC,iBAAiBX,MAAlB;qCACsBI,qBAAqB,CAAC3C,IAAD;EAC3CO,cAAAA,WAAW,EAAE;EAD8B,eAExCZ,OAFwC,mBAAvCwD;;uBAKCC,uBAAuB,CAACD,SAAD;;;;;;EAiBjC,OA9CD;EAAA;EAAA;EAAA,MADkB,kBAAdE;EAkDN,aAAOA,KAAK,CAACC,IAAN,EAAP;;EACD,GA/DD;EAAA;EAAA;EAAA;;EAiEA,SAASF,uBAAT,CAAiCD,SAAjC,EAA4CzD,MAA5C;EACE,SAAOyD,SAAP,oBAAOA,SAAS,CAAEI,OAAX,CAAmB,UAACC,QAAD;;;EACxB,QAAMvC,IAAI,GACR,CAAAuC,QAAQ,QAAR,8BAAAA,QAAQ,CAAEhD,IAAV,oCAAgBiD,KAAhB,MAA0B7F,OAAO,CAACC,GAAR,CAAYyD,iBAAtC,GACI,GADJ,GAEIkC,QAFJ,uCAEIA,QAAQ,CAAEhD,IAFd,qBAEI,gBAAgBiD,KAHtB;EAKA,QAAMjD,IAAI,GAAG;EACXC,MAAAA,MAAM,EAAE;EACNQ,QAAAA,IAAI,EAAE,OAAGA,IAAH,oBAAGA,IAAI,CAAEyC,OAAN,CAAc,UAAd,EAA0B,EAA1B,CAAH,GAAmCC,KAAnC,CAAyC,GAAzC;EADA;EADG,KAAb;;EAMA,QAAIjE,MAAJ,EAAY;EACVc,MAAAA,IAAI,CAAC,QAAD,CAAJ,GAAiBd,MAAjB;EACD;;EAED,WAAOc,IAAP;EACD,GAjBM,CAAP;EAkBD;;MCiFqBoD,WAAtB,YAAsBA,WAAtB,CACE5D,IADF,EAEE6D,IAFF,EAGElE,OAHF;EAAA;;;EAQEA,IAAAA,OAAO;EACLY,MAAAA,WAAW,EAAE,IADR;EAELE,MAAAA,MAAM,EAAE;EAFH,OAGFd,OAHE,CAAP;6BAMsBI,6BAA6B,CACjDC,IADiD,EAEjD,cAAAL,OAAO,SAAP,sBAASD,MAAT,oBAAoBC,OAApB,qBAAoB,UAAS0B,aAA7B,IAA6C1B,OAAO,CAACD,MAArD,GAA8DkD,SAFb,kBAA7CC;;;EAKN,UAAI,CAACA,OAAL,EAAc;EACZ,cAAM,IAAI7D,KAAJ,8BAAqCgB,IAArC,iBAAN;EACD;;EAED,UAAMJ,GAAG,GAAGC,QAAQ,CAAIgD,OAAJ,SAAegB,IAAf,4BACflE,OADe,qBACf,UAASc,MADM,EAApB;;sBAIuBjC;6BAAMoB,GAAG,CAACrB,QAAJ;;+BACZe,YAAY,CAACK,OAAD;iCADN,wBAAsB;EAC3ChB,UAAAA,OAAO;EADoC,SAAtB,kBAAjBG;EAIN,cAAI,CAACA,QAAQ,CAACC,EAAd,EAAkB;EAChB,kBAAM,IAAIC,KAAJ,CAAUF,QAAQ,CAACG,UAAnB,CAAN;EACD;;mCAEkBH,QAAQ,CAACI,IAAT,mBAAbA;EAEN,mBAAOS,OAAO,CAACY,WAAR,GAAsBA,WAAW,CAACrB,IAAD,CAAjC,GAA0CA,IAAjD;;;;;EACD,GAtCD;EAAA;EAAA;EAAA;AAnGA,MAAsB4E,iBAAtB,YAAsBA,iBAAtB,CACEtD,IADF,EAEEb,OAFF;EAAA;;;EAQEA,IAAAA,OAAO;EACLY,MAAAA,WAAW,EAAE,IADR;EAELwD,MAAAA,aAAa,EAAE,KAFV;EAGLtD,MAAAA,MAAM,EAAE;EAHH,OAIFd,OAJE,CAAP;;EAOA,QAAI,CAACa,IAAL,EAAW;EACT,6BAAO,IAAP;EACD;;EAED,QACEb,OAAO,CAACD,MAAR,IACAC,OAAO,CAAC0B,aADR,IAEAb,IAAI,CAACwD,OAAL,CAAarE,OAAO,CAACD,MAArB,MAAiC,CAHnC,EAIE;EACAc,MAAAA,IAAI,GAAGA,IAAI,KAAK,GAAT,GAAeA,IAAf,GAAsBA,IAAI,CAACkD,OAAL,CAAa,MAAb,EAAqB,EAArB,CAA7B;EACAlD,MAAAA,IAAI,GAAGM,kBAAkB,CAAC;EACxBL,QAAAA,MAAM,EAAE;EAAEQ,UAAAA,IAAI,EAAE,CAACT,IAAD;EAAR,SADgB;EAExBd,QAAAA,MAAM,EAAEC,OAAO,CAACD,MAFQ;EAGxB2B,QAAAA,aAAa,EAAE1B,OAAO,CAAC0B;EAHC,OAAD,CAAzB;EAKD;;yCAE6D1B,4BAAA,UAASc;kDAA/DwD;UAAAA,qDAAkB;UAAyBxD;;EACnD,QAAMyD,cAAc,GAAG,IAAIC,eAAJ,cAClB1D,MADkB,EAAvB;;EAIA,QAAId,OAAO,CAACoE,aAAZ,EAA2B;EACzBG,MAAAA,cAAc,CAAC9E,GAAf,CAAmB,iBAAnB,EAAsC6E,eAAtC;EACD;;EAED,QAAMG,OAAO,GAAG,CACd;EACEC,MAAAA,SAAS,EAAE,QADb;EAEEC,MAAAA,MAAM,EAAE,MAFV;EAGEC,MAAAA,GAAG,mCAAiC/D,IAAjC,kBAHL;EAIE7B,MAAAA,OAAO,EAAE;EAAE6F,QAAAA,MAAM,EAAE;EAAV;EAJX,KADc,EAOd;EACEH,MAAAA,SAAS,EAAE,kBADb;EAEEC,MAAAA,MAAM,EAAE,MAFV;EAGEC,MAAAA,GAAG,4CAA0CL,cAAc,CAAC3F,QAAf,EAH/C;EAIEkG,MAAAA,OAAO,EAAE,CAAC,QAAD;EAJX,KAPc,CAAhB;EAgBA;EACA;;EACA,QAAIC,eAAe,GAAG,cAAtB;;EACA,QACE/E,OAAO,CAACD,MAAR,IACAC,OAAO,CAAC0B,aADR,IAEA1B,OAAO,CAACD,MAAR,KAAmBC,OAAO,CAAC0B,aAH7B,EAIE;EACAqD,MAAAA,eAAe,SAAO/E,OAAO,CAACD,MAAf,iBAAf;EACD;;EAED,QAAME,GAAG,GAAGC,QAAQ,CAAC6E,eAAD,EAAkB;EACpCC,MAAAA,OAAO,EAAE;EAD2B,KAAlB,CAApB;;oBAIuBnG;2BAAMoB,GAAG,CAACrB,QAAJ;;6BAGZe,YAAY,CAACK,OAAD;+BAHN,wBAAsB;EAC3CjB,QAAAA,MAAM,EAAE,MADmC;EAE3CkG,QAAAA,WAAW,EAAE,SAF8B;EAG3CjG,QAAAA,OAAO,eAHoC;EAI3CkG,QAAAA,QAAQ,EAAE,QAJiC;EAK3ChG,QAAAA,IAAI,EAAEiG,IAAI,CAACjE,SAAL,CAAeuD,OAAf;EALqC,OAAtB,kBAAjBtF;EAQN,YAAI,CAACA,QAAQ,CAACC,EAAd,EAAkB;EAChB,gBAAM,IAAIC,KAAJ,CAAUF,QAAQ,CAACG,UAAnB,CAAN;EACD;;iCAEkBH,QAAQ,CAACI,IAAT,mBAAbA;;;EAEN,cAAI,CAACA,IAAI,CAAC,yBAAD,CAAT,EAAsC;EACpC,mBAAO,IAAP;EACD;;EAED,cAAM8C,IAAI,GAAG8C,IAAI,CAACC,KAAL,0BAAW7F,IAAI,CAAC,yBAAD,CAAf,qBAAW,sBAAiCL,IAA5C,CAAb;;EAEA,cAAImD,IAAI,CAACgD,MAAT,EAAiB;EACf,kBAAM,IAAIhG,KAAJ,CAAUgD,IAAI,CAACgD,MAAL,CAAY,CAAZ,EAAeC,MAAzB,CAAN;EACD;;EAED,iBAAOtF,OAAO,CAACY,WAAR,GAAsBA,WAAW,CAACyB,IAAD,CAAjC,GAA0CA,IAAjD;;;;EACD,GAjGD;EAAA;EAAA;EAAA;AAvDA,MAAsBkD,sBAAtB,YAAsBA,sBAAtB,CACElF,IADF,EAEEe,OAFF,EAGEpB,OAHF;EAAA;;;EAWEA,IAAAA,OAAO;EACLY,MAAAA,WAAW,EAAE,IADR;EAEL;EACA;EACAwD,MAAAA,aAAa,EAAE,UAAUoB,IAAV,CAAenF,IAAf;EAJV,OAKFL,OALE,CAAP;EAQA,QAAMa,IAAI,GAAGM,kBAAkB,CAACC,OAAD,cAAUpB,OAAV,qBAAU,SAASqB,MAAnB,CAA/B;EAGA;EACA;EACA;EACA;EACA;EACA;;EAEA,QAAMoE,WAAW,GAAGrE,OAAO,CAACqE,WAA5B;6BAEuBtB,iBAAiB,CAAItD,IAAJ,EAAU;EAChDD,MAAAA,WAAW,EAAEZ,OAAO,CAACY,WAD2B;EAEhDwD,MAAAA,aAAa,EAAEpE,OAAO,CAACoE,aAFyB;EAGhDrE,MAAAA,MAAM,EAAEqB,OAAO,CAACrB,MAHgC;EAIhD2B,MAAAA,aAAa,EAAEN,OAAO,CAACM,aAJyB;EAKhDZ,MAAAA,MAAM;EACJwD,QAAAA,eAAe,EAAEmB,WAAF,oBAAEA,WAAW,CAAEnB;EAD1B,sBAEDtE,OAFC,qBAED,UAASc,MAFR;EAL0C,KAAV,kBAAlC+C;eAiBF,CAACzC,OAAO,CAACrB,MAAT,IAAmB,EAAC8D,QAAD,oBAACA,QAAQ,CAAE6B,gBAAX,IACd,OAGF7B;;EATP;EACA;EACA;EACA;EACA;EAMD,GArDD;EAAA;EAAA;EAAA;;MCmDsB8B,qBAAtB,YAAsBA,qBAAtB,CACErE,IADF,EAEEtB,OAFF;EAAA;6BAIuBmE,iBAAiB,CAAC7C,IAAD,EAAOtB,OAAP,kBAAhC4F;EAEN,UAAI,CAACA,MAAL,EAAa;EACX,eAAO,IAAP;EACD;;EAED,UAAI,EAACA,MAAD,oBAACA,MAAM,CAAE/E,IAAT,CAAJ,EAAmB;EACjB,cAAM,IAAIxB,KAAJ,2DACoDuG,MAAM,CAACvF,IAD3D,CAAN;EAGD;;EAED,aAAO,CAAAuF,MAAM,QAAN,YAAAA,MAAM,CAAEF,gBAAR,IACHE,MAAM,CAAC/E,IAAP,CAAYiD,KADT,SAEC8B,MAAM,CAAC/E,IAAP,CAAYgF,QAFb,GAEwBD,MAAM,CAAC/E,IAAP,CAAYiD,KAF3C;;EAGD,GAnBD;EAAA;EAAA;EAAA;AAnDA,MAAsBgC,cAAtB,YAAsBA,cAAtB,CACEC,OADF,EAEE5G,QAFF,EAGEa,OAHF;EAAA;2BAKmE+F,OAAO,CAACC;UAAjE1E,sBAAAA;UAAMgD,iCAAAA;UAAiB2B,wBAAAA;UAAQlG,wBAAAA;UAAQ2B,+BAAAA;;EAE/C,QAAIuE,MAAM,KAAKhI,OAAO,CAACC,GAAR,CAAYgI,qBAA3B,EAAkD;EAChD,6BAAO/G,QAAQ,CAACgH,MAAT,CAAgB,GAAhB,EAAqB5G,IAArB,CAA0B;EAC/B6G,QAAAA,OAAO,EAAE,CAAApG,OAAO,QAAP,YAAAA,OAAO,CAAEqG,aAAT,CAAuBJ,MAAvB,KAAiC;EADX,OAA1B,CAAP;EAGD;;EAED,QAAI,CAAC3E,IAAL,EAAW;EACT,6BAAOnC,QAAQ,CACZgH,MADI,CACG,GADH,EAEJG,GAFI,CAEA;EAAEF,QAAAA,OAAO,EAAE,CAAApG,OAAO,QAAP,YAAAA,OAAO,CAAEqG,aAAT,CAAuB/E,IAAvB,KAA+B;EAA1C,OAFA,CAAP;EAGD;;EAED,QAAIiF,QAAQ,GAAiC;EAC3CnC,MAAAA,aAAa,EAAE,OAAOE,eAAP,KAA2B;EADC,KAA7C;;EAGA,QAAIvE,MAAM,IAAI2B,aAAd,EAA6B;EAC3B6E,MAAAA,QAAQ,gBACHA,QADG;EAENxG,QAAAA,MAAM,EAAEA,MAFF;EAGN2B,QAAAA,aAAa,EAAEA;EAHT,QAAR;EAKD;;6BAEiBiE,qBAAqB,CAACrE,IAAD,EAAiBiF,QAAjB,kBAAjCtG;EAEN,UAAI,CAACA,GAAL,EAAU;EACRd,QAAAA,QAAQ,CACLgH,MADH,CACU,GADV,EAEGG,GAFH,CAEO;EAAEF,UAAAA,OAAO,EAAE,CAAApG,OAAO,QAAP,YAAAA,OAAO,CAAEqG,aAAT,CAAuB/E,IAAvB,KAA+B;EAA1C,SAFP;EAGD;;EAEDnC,MAAAA,QAAQ,CAACqH,cAAT,CAAwB;EACtBlC,QAAAA,eAAe,EAAfA;EADsB,OAAxB;EAIAnF,MAAAA,QAAQ,CAACsH,SAAT,CAAmB,GAAnB,EAAwB;EAAEC,QAAAA,QAAQ,EAAEzG;EAAZ,OAAxB;EAEA,aAAOd,QAAQ,CAACmH,GAAT,EAAP;;EACD,GA7CD;EAAA;EAAA;EAAA;AAJA,WAAgBK,cAAc3G;EAC5B,SAAO,UAAC+F,OAAD,EAAU5G,QAAV;EAAA,WAAuB2G,cAAc,CAACC,OAAD,EAAU5G,QAAV,EAAoBa,OAApB,CAArC;EAAA,GAAP;EACD;;MCTqB4G,0BAAtB,YAAsBA,0BAAtB,CACExF,OADF,EAEEpB,OAFF;EAAA;EAOEA,IAAAA,OAAO;EACLqB,MAAAA,MAAM,EAAE;EADH,OAEFrB,OAFE,CAAP;EAIA,QAAMC,GAAG,GAAGC,QAAQ,CAAC,wBAAD,EAA2B;EAC7CW,MAAAA,IAAI,EAAEM,kBAAkB,CAACC,OAAD,EAAUpB,OAAO,CAACqB,MAAlB;EADqB,KAA3B,CAApB;;oBAIuBxC;2BAAMoB,GAAG,CAACrB,QAAJ;;6BACZe,YAAY,CAACK,OAAD;+BADN,wBAAsB;EAC3ChB,QAAAA,OAAO;EADoC,OAAtB,kBAAjBG;EAIN,YAAIA,QAAQ,CAACgH,MAAT,KAAoB,GAAxB,EAA6B;EAC3B,iBAAO,IAAP;EACD;;EAED,YAAI,CAAChH,QAAQ,CAACC,EAAd,EAAkB;EAChB,gBAAM,IAAIC,KAAJ,CAAUF,QAAQ,CAACG,UAAnB,CAAN;EACD;;iCAEkBH,QAAQ,CAACI,IAAT,mBAAbA;EAEN,iBAAOA,IAAI,CAACsH,OAAL,CAAaC,YAApB;;;;EACD,GA9BD;EAAA;EAAA;EAAA;;MCDsBC,OAAtB,YAAsBA,OAAtB,CACE5E,IADF,EAEEnC,OAFF;EAAA;;;EAgBEA,IAAAA,OAAO;EACLY,MAAAA,WAAW,EAAE;EADR,OAEFZ,OAFE,CAAP;EAKA,QAAMoC,YAAY,GAChB,aAAApC,OAAO,SAAP,qBAASD,MAAT,KAAmBC,OAAO,CAACD,MAAR,KAAmBC,OAAO,CAAC0B,aAA9C,SACQ1B,OAAO,CAACD,MADhB,GAEI,EAHN;;wBAK4BoC,IAAI,CAAC6B,KAAL,CAAW,IAAX;UAArBgD;UAAQC;;EAEf,QAAMhH,GAAG,GAAGC,QAAQ,CACfkC,YADe,uBACe4E,MADf,SACyBC,SADzB,EAElBjH,OAAO,CAACc,MAFU,CAApB;;oBAKuBjC;2BAAMoB,GAAG,CAACrB,QAAJ;;6BACZe,YAAY,CAACK,OAAD;+BADN,wBAAsB;EAC3ChB,QAAAA,OAAO;EADoC,OAAtB,kBAAjBG;EAIN,YAAI,CAACA,QAAQ,CAACC,EAAd,EAAkB;EAChB,gBAAM,IAAIC,KAAJ,CAAUF,QAAQ,CAACG,UAAnB,CAAN;EACD;;iCAEkBH,QAAQ,CAACI,IAAT,mBAAb8C;EAEN,cAAM6E,OAAO,GAAGlH,OAAO,CAACY,WAAR,GAAsBA,WAAW,CAACyB,IAAD,CAAjC,GAA0CA,IAA1D;EAEA,iBAAO;EACL6E,YAAAA,OAAO,EAAPA,OADK;EAELC,YAAAA,IAAI,EAAE9E,IAAI,CAAC8E,IAFN;EAGL5G,YAAAA,KAAK,EAAE8B,IAAI,CAAC9B;EAHP,WAAP;;;;EAKD,GAlDD;EAAA;EAAA;EAAA;;;;;;;;;;;;;;;;ACGA,WAAgB6G,QACdjF;EAOA,MAAMkF,QAAM,GAAGC,gBAAS,EAAxB;;0BACwBC,cAAA,CAGrB,IAHqB;QAAjBlF;QAAMmF;;2BAIaD,cAAA,CAAe,IAAf;QAAnBE;QAAOC;;2BACoBH,cAAA,CAAwB,KAAxB;QAA3BI;QAAWC;;EAElBL,EAAAA,eAAA,CAAgB;EACd,QAAMM,cAAc,YAAdA,cAAc;EAAA;EAClBD,QAAAA,YAAY,CAAC,IAAD,CAAZ;;0CACI;EAAA,iCACiB1F,OAAO,CAACC,IAAD,EAAO;EAC/BpC,YAAAA,MAAM,EAAEsH,QAAM,CAACtH,MADgB;EAE/B2B,YAAAA,aAAa,EAAE2F,QAAM,CAAC3F;EAFS,WAAP,CADxB,iBACIW,IADJ;EAKFmF,YAAAA,OAAO,CAACnF,IAAD,CAAP;EACAuF,YAAAA,YAAY,CAAC,KAAD,CAAZ;EANE;EAOH,qBAAQH,OAAO;EACdC,UAAAA,QAAQ,CAACD,KAAD,CAAR;EACAG,UAAAA,YAAY,CAAC,KAAD,CAAZ;EACD;;;EACF,OAbmB;EAAA;EAAA;EAAA,KAApB;;EAcAC,IAAAA,cAAc;EACf,GAhBD,EAgBG,CAACR,QAAM,CAACtH,MAAR,CAhBH;EAkBA,sBAAYsC,IAAZ;EAAkBoF,IAAAA,KAAK,EAALA,KAAlB;EAAyBE,IAAAA,SAAS,EAATA;EAAzB;EACD;;;;;;;;;;;;;;;;;;;;;;;;;;"}